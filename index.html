<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ghost of Tsushima 3D - Pixel Style RPG</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading-screen">
        <div class="loading-content">
            <h1>Ghost of Tsushima 3D</h1>
            <div class="loading-bar">
                <div class="loading-progress"></div>
            </div>
            <p>Loading...</p>
        </div>
    </div>

    <!-- Game UI -->
    <div id="game-ui" class="hidden">
        <!-- Health Bar -->
        <div id="health-container">
            <div id="health-bar">
                <div id="health-fill"></div>
            </div>
        </div>

        <!-- Mini Map -->
        <div id="minimap-container">
            <canvas id="minimap" width="150" height="150"></canvas>
        </div>

        <!-- Inventory -->
        <div id="inventory" class="hidden">
            <h3>Inventory</h3>
            <div id="inventory-grid"></div>
        </div>

        <!-- Quest Log -->
        <div id="quest-log" class="hidden">
            <h3>Quest Log</h3>
            <div id="quest-list"></div>
        </div>

        <!-- Controls Guide -->
        <div id="controls-guide">
            <p>WASD: Move | Mouse: Look | Space: Jump | E: Interact | I: Inventory | Q: Quest Log | T: Tutorial</p>
        </div>
    </div>

    <!-- Three.js and other libraries -->
    <script>
        // Fallback mechanism for Three.js loading
        window.THREE = window.THREE || {};
        
        function loadScript(src, fallbackSrc = null) {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = src;
                script.onload = resolve;
                script.onerror = () => {
                    if (fallbackSrc) {
                        console.warn(`Failed to load ${src}, trying fallback...`);
                        loadScript(fallbackSrc).then(resolve).catch(reject);
                    } else {
                        reject(new Error(`Failed to load ${src}`));
                    }
                };
                document.head.appendChild(script);
            });
        }
        
        // Load libraries with fallbacks
        Promise.all([
            loadScript('https://cdnjs.cloudflare.com/ajax/libs/three.js/r158/three.min.js', 
                      'https://unpkg.com/three@0.158.0/build/three.min.js'),
            loadScript('https://cdnjs.cloudflare.com/ajax/libs/three.js/r158/examples/js/controls/PointerLockControls.js',
                      'https://unpkg.com/three@0.158.0/examples/js/controls/PointerLockControls.js'),
            loadScript('https://cdnjs.cloudflare.com/ajax/libs/three.js/r158/examples/js/loaders/GLTFLoader.js',
                      'https://unpkg.com/three@0.158.0/examples/js/loaders/GLTFLoader.js'),
            loadScript('https://cdnjs.cloudflare.com/ajax/libs/simplex-noise/2.4.0/simplex-noise.min.js',
                      'https://unpkg.com/simplex-noise@2.4.0/simplex-noise.min.js'),
            loadScript('https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.3/howler.min.js',
                      'https://unpkg.com/howler@2.2.3/dist/howler.min.js')
        ]).then(() => {
            console.log('All libraries loaded successfully');
        }).catch(error => {
            console.error('Failed to load libraries:', error);
        });
    </script>
    
    <!-- Debug System (load first) -->
    <script src="js/debug-system.js"></script>
    
    <!-- Game Scripts -->
    <script src="js/utils/noise.js"></script>
    <script src="js/systems/world-generator.js"></script>
    <script src="js/systems/player.js"></script>
    <script src="js/systems/combat.js"></script>
    <script src="js/systems/audio.js"></script>
    <script src="js/systems/ui.js"></script>
    <script src="js/game.js"></script>
</body>
</html>